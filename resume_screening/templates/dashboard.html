{% extends "screening.html" %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="flex justify-between h-[20vh] w-full">
    <div class="w-[17vw] h-full bg-white rounded-xl transition-transform duration-500 hover:-translate-y-2">
        <div class="px-2 py-6">
            <div class="flex justify-between items-center ">
                <p class='text-md text-stone-500 font-semibold'>TOTAL CANDIDATES</p>
                <div class="bg-blue-50 p-2 rounded-lg">
                    <img class='h-6 w-6' src="{% static 'images/group.png' %}" alt="candidates">
                </div>
            </div>
            <p class='text-3xl text-stone-700 font-semibold ml-3 mt-6'>{{ total_candidates }}</p>
        </div>
    </div>
    <div class="w-[17vw] h-full bg-white rounded-xl transition-transform duration-500 hover:-translate-y-2">
        <div class="px-2 py-6">
            <div class="flex justify-between items-center ">
                <p class='text-md text-stone-500 font-semibold'>SHORTLISTED</p>
                <div class="bg-green-100 p-2 rounded-lg">
                    <img class='h-6 w-6' src="{% static 'images/check.png' %}" alt="candidates">
                </div>
            </div>
            <p class='text-3xl text-stone-700 font-semibold ml-3 mt-6'>{{ shortlisted }}</p>
        </div>
    </div>
    <div class="w-[17vw] h-full bg-white rounded-xl transition-transform duration-500 hover:-translate-y-2">
        <div class="px-2 py-6">
            <div class="flex justify-between items-center ">
                <p class='text-md text-stone-500 font-semibold'>REVIEW</p>
                <div class="bg-red-50 p-2 rounded-lg">
                    <img class='h-6 w-6' src="{% static 'images/danger-sign.png' %}" alt="candidates">
                </div>
            </div>
            <p class='text-3xl text-stone-700 font-semibold ml-3 mt-6'>{{ review }}</p>
        </div>
    </div>
    <div class="w-[17vw] h-full bg-white rounded-xl transition-transform duration-500 hover:-translate-y-2">
        <div class="px-2 py-6">
            <div class="flex justify-between items-center ">
                <p class='text-md text-stone-500 font-semibold'>AVG. MATCH SCORE</p>
                <div class="bg-amber-50 p-2 rounded-lg">
                    <img class='h-5 w-5' src="{% static 'images/percentage.png' %}" alt="candidates">
                </div>
            </div>
            <p class='text-3xl text-stone-700 font-semibold ml-3 mt-6'>{{ avg_score | floatformat:2 }}%</p>
        </div>
    </div>
</div>
{% if candidates %}
<div class="h-[62vh] w-full px-6 py-9 bg-white rounded-xl mt-9">
    <p class='text-stone-700 font-semibold mb-6'>Top 5 Candidates - Match Score</p>
    <canvas id="scoreChart" width="400" height="140"></canvas>
</div>
{% else %}
<div class="flex items-center h-[45vh] w-full px-6 py-9 bg-white rounded-xl mt-9">
    <p class='text-stone-400 mx-auto'>No Resume Screened yet</p>
</div>
{% endif %}

<script>
    // Get top 5 candidates data from Django
    const candidatesData = [
        {% for candidate in top_candidates %}
        {
            name: "{{ candidate.name }}",
            score: {{ candidate.score }}
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];
    
    // Prepare data for chart
    const labels = candidatesData.map(c => c.name);
    const scores = candidatesData.map(c => c.score);
    
    // Create chart
    const ctx = document.getElementById('scoreChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Match Score (%)',
                data: scores,
                backgroundColor: [
                    'rgba(34, 197, 94, 0.8)',   // Green
                    'rgba(59, 130, 246, 0.8)',  // Blue
                    'rgba(251, 146, 60, 0.8)',  // Orange
                    'rgba(168, 85, 247, 0.8)',  // Purple
                    'rgba(236, 72, 153, 0.8)'   // Pink
                ],
                borderColor: [
                    'rgb(34, 197, 94)',
                    'rgb(59, 130, 246)',
                    'rgb(251, 146, 60)',
                    'rgb(168, 85, 247)',
                    'rgb(236, 72, 153)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return 'Score: ' + context.parsed.y + '%';
                        }
                    }
                }
            }
        }
    });
</script>

{% endblock %}